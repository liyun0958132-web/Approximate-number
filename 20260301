<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>æ¦‚æ•¸é­”æ³•å¸« - å°ˆæ¥­æ•¸ç·šæ•´åˆç‰ˆ</title>
    <style>
        :root { --floor: #1565c0; --ceil: #ef6c00; --round: #7b1fa2; --bg: #f8fafc; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        /* 1. ä»»å‹™é¸æ“‡é é¢ - å®Œå…¨ä¿ç•™è¦–è¦ºé¢¨æ ¼ */
        .task-list { width: 900px; display: flex; flex-direction: column; gap: 20px; margin-top: 30px; }
        .task-row { border-radius: 25px; padding: 35px 45px; color: white; cursor: pointer; transition: transform 0.2s; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .task-row:hover { transform: scale(1.02); }
        .task-row h2 { margin: 0 0 10px 0; font-size: 2.5rem; letter-spacing: 2px; }
        .task-row p { margin: 0; font-size: 1.4rem; font-weight: bold; opacity: 0.95; }
        .bg-orange { background-color: #e67e22; }
        .bg-green { background-color: #27ae60; }
        .bg-blue { background-color: #2980b9; }
        .bg-purple { background-color: #8e44ad; }

        /* 2. éŠæˆ²ä¸»å€åŸŸ */
        #game-area { display: none; width: 1100px; background: white; padding: 40px; border-radius: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.15); text-align: center; margin-top: 20px; }
        .quest-header { background: #f1f5f9; padding: 20px; border-radius: 20px; margin-bottom: 30px; text-align: left; border-left: 10px solid #cbd5e1; }
        
        .control-panel { display: flex; justify-content: center; align-items: center; gap: 40px; margin-bottom: 40px; }
        .unit-selector { display: flex; gap: 10px; }
        .unit-btn { padding: 12px 24px; border: 2px solid #d1d5db; border-radius: 12px; background: white; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .unit-btn.active { border-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; box-shadow: 0 0 0 2px #3b82f6 inset; }
        .input-box { font-size: 2.5rem; width: 200px; padding: 10px; border: 4px solid #3b82f6; border-radius: 15px; text-align: center; outline: none; }

        /* 3. å°ˆæ¥­æ•¸ç·šç³»çµ± - ç²¾ç¢ºèª¿æ•´å‚ç›´å®šä½ */
        .ruler-viewport { width: 1000px; height: 240px; margin: 40px auto; position: relative; }
        
        /* èª¿æ•´èªªæ˜ï¼š
           æ•¸ç·š (.main-axis) åœ¨ top: 130pxã€‚
           æ°£æ³¡èº«é«”é«˜åº¦ç´„ 50px + å°–ç«¯ 15px = 65pxã€‚
           è¨­å®š top: 65pxï¼Œå°–ç«¯å°±æœƒç²¾ç¢ºè¸©åœ¨ 130px çš„é»‘ç·šä¸Šã€‚ */
        #pointer-tag { 
            position: absolute; 
            top: 65px; 
            transform: translateX(-50%); 
            z-index: 50; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            transition: left 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); 
        }
        .tag-body { background: #f44336; color: white; padding: 8px 20px; border-radius: 12px; font-size: 2rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .tag-arrow { 
            width: 0; height: 0; 
            border-left: 12px solid transparent; border-right: 12px solid transparent; 
            border-top: 15px solid #f44336; 
            margin-top: -1px; /* æ¶ˆé™¤èˆ‡èº«é«”é–“çš„å¾®å°ç¸«éš™ */
        }
        #impact-emoji { position: absolute; top: -60px; font-size: 4rem; display: none; }

        .main-axis { position: absolute; top: 130px; width: 1000px; height: 4px; background: #000; }
        .tick-long { position: absolute; top: 130px; width: 4px; height: 40px; background: #000; }
        .tick-short { position: absolute; top: 130px; width: 2px; height: 15px; background: #888; }
        .tick-text { position: absolute; top: 45px; left: 50%; transform: translateX(-50%); font-size: 1.2rem; font-weight: bold; color: #333; }

        /* 4. æ–¹æ³•é¸æ“‡æŒ‰éˆ• */
        .method-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 40px; }
        .method-btn { padding: 20px; font-size: 1.4rem; font-weight: bold; color: white; border: none; border-radius: 18px; cursor: pointer; transition: 0.2s; box-shadow: 0 5px 0 rgba(0,0,0,0.2); }
        .method-btn:active { transform: translateY(4px); box-shadow: none; }

        #feedback-msg { margin-top: 30px; padding: 20px; border-radius: 15px; font-size: 1.4rem; font-weight: bold; display: none; background: #fffde7; border: 2px dashed #facc15; }
    </style>
</head>
<body>

<div id="start-screen" class="task-list">
    <div class="task-row bg-orange" onclick="startGame('ceil', 'ä»»å‹™ Aï¼šè²·è‰²ç´™/æº–å‚™è»Šè¼›', 'ç¢ºä¿æ¯å€‹äººéƒ½æœ‰ï¼Œå°‘ä¸€ä»½éƒ½ä¸è¡Œã€‚å“ªæ€•åªå¤šå‡ºä¸€é»é»ï¼Œä¹Ÿè¦å¤šæº–å‚™ä¸€æ•´çµ„ã€‚')">
        <h2>ä»»å‹™ A</h2>
        <p>ä¾‹å¦‚ï¼šè²·è‰²ç´™ã€æº–å‚™è»Šè¼›ã€é ˜å–ç¦®åˆ¸...</p>
    </div>
    <div class="task-row bg-green" onclick="startGame('floor', 'ä»»å‹™ Bï¼šç‰©å“æ‰“åŒ…', 'å¿…é ˆè£æ»¿ä¸€å€‹å®Œæ•´çš„ç›’å­æ‰ç®—ã€‚å‰©ä¸‹ä¾†ä¸å¤ è£æ»¿ä¸€ç›’çš„ä¸èƒ½ç®—æ•¸ã€‚')">
        <h2>ä»»å‹™ B</h2>
        <p>ä¾‹å¦‚ï¼šé¤…ä¹¾è£ç›’ã€æ°´æœè£ç®±ã€ç©æœ¨è£è¢‹...</p>
    </div>
    <div class="task-row bg-blue" onclick="startGame('floor', 'ä»»å‹™ Cï¼šå¤§è³£å ´æŠ˜æ‰£', 'çµå¸³æ™‚ã€Œå»é›¶é ­ã€å„ªæƒ ã€‚ç„¡è«–å°¾æ•¸å¤šå°‘ï¼Œé€šé€šæ¨æ£„ä¸è¨ˆã€‚')">
        <h2>ä»»å‹™ C</h2>
        <p>ä¾‹å¦‚ï¼šå¤§è³£å ´çµå¸³ã€è€é—†æŠ˜æ‰£ã€å»é›¶é ­å„ªæƒ ...</p>
    </div>
    <div class="task-row bg-purple" onclick="startGame('round', 'ä»»å‹™ Dï¼šä¼°è¨ˆè·é›¢', 'è§€å¯Ÿæ•¸å­—é›¢å“ªä¸€å€‹æ•´æ•¸æ¨™è¨˜æ¯”è¼ƒè¿‘ã€‚æ‰¾ä¸€å€‹æœ€æ¥è¿‘çš„å¤§ç´„æ•¸ã€‚')">
        <h2>ä»»å‹™ D</h2>
        <p>ä¾‹å¦‚ï¼šæ¸¬é‡è·é›¢ã€å¤§ç´„é•·åº¦ã€å·®ä¸å¤šæ˜¯å¤šå°‘...</p>
    </div>
</div>

<div id="game-area">
    <div class="quest-header">
        <h2 id="display-title" style="margin:0 0 10px 0; color:#1e293b;"></h2>
        <p id="display-desc" style="margin:0; color:#64748b; font-size:1.2rem;"></p>
    </div>

    <div class="control-panel">
        <div>
            <span style="font-weight:bold; color:#475569;">è¼¸å…¥æ•¸å­—ï¼š</span>
            <input type="number" id="inputVal" class="input-box" value="4628" oninput="renderRuler()">
        </div>
        <div class="unit-selector">
            <button class="unit-btn" id="u10" onclick="updateUnit(10)">åä½</button>
            <button class="unit-btn active" id="u100" onclick="updateUnit(100)">ç™¾ä½</button>
            <button class="unit-btn" id="u1000" onclick="updateUnit(1000)">åƒä½</button>
            <button class="unit-btn" id="u10000" onclick="updateUnit(10000)">è¬ä½</button>
        </div>
    </div>

    <div class="ruler-viewport">
        <div id="pointer-tag">
            <div id="impact-emoji">ğŸŒŸ</div>
            <div class="tag-body" id="tag-text">4,628</div>
            <div class="tag-arrow"></div>
        </div>
        <div class="main-axis"></div>
        <div id="ticks-layer"></div>
    </div>

    <div class="method-grid">
        <button class="method-btn" style="background:var(--floor)" onclick="checkAnswer('floor')">ç„¡æ¢ä»¶æ¨å»æ³•</button>
        <button class="method-btn" style="background:var(--ceil)" onclick="checkAnswer('ceil')">ç„¡æ¢ä»¶é€²å…¥æ³•</button>
        <button class="method-btn" style="background:var(--round)" onclick="checkAnswer('round')">å››æ¨äº”å…¥æ³•</button>
    </div>

    <div id="feedback-msg"></div>
    <button onclick="location.reload()" style="margin-top:30px; background:none; border:none; color:#94a3b8; cursor:pointer; text-decoration:underline; font-size:1.1rem;">â¬… è¿”å›ä»»å‹™é¸å–®</button>
</div>

<script>
    let currentMode = '';
    let currentUnit = 100;
    let baseStart = 0;

    function startGame(mode, title, desc) {
        currentMode = mode;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        document.getElementById('display-title').innerText = title;
        document.getElementById('display-desc').innerText = desc;
        renderRuler();
    }

    function updateUnit(u) {
        currentUnit = u;
        document.querySelectorAll('.unit-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('u' + u).classList.add('active');
        renderRuler();
    }

    function renderRuler() {
        const val = parseInt(document.getElementById('inputVal').value) || 0;
        const container = document.getElementById('ticks-layer');
        container.innerHTML = '';
        document.getElementById('feedback-msg').style.display = 'none';
        document.getElementById('impact-emoji').style.display = 'none';

        baseStart = Math.floor(val / (currentUnit * 10)) * (currentUnit * 10);
        
        for (let i = 0; i <= 10; i++) {
            const tickVal = baseStart + (i * currentUnit);
            const xPos = i * 100;

            const longTick = document.createElement('div');
            longTick.className = 'tick-long';
            longTick.style.left = xPos + 'px';
            
            const label = document.createElement('div');
            label.className = 'tick-text';
            label.innerText = tickVal.toLocaleString();
            longTick.appendChild(label);
            container.appendChild(longTick);

            if (i < 10) {
                for (let j = 1; j < 10; j++) {
                    const shortTick = document.createElement('div');
                    shortTick.className = 'tick-short';
                    shortTick.style.left = (xPos + j * 10) + 'px';
                    container.appendChild(shortTick);
                }
            }
        }

        const tag = document.getElementById('pointer-tag');
        const offset = ((val - baseStart) / currentUnit) * 100;
        tag.style.left = offset + 'px';
        document.getElementById('tag-text').innerText = val.toLocaleString();
    }

    function checkAnswer(method) {
        const val = parseInt(document.getElementById('inputVal').value) || 0;
        const msg = document.getElementById('feedback-msg');
        const emoji = document.getElementById('impact-emoji');
        
        let result = 0;
        if (method === 'floor') result = Math.floor(val / currentUnit) * currentUnit;
        else if (method === 'ceil') result = Math.ceil(val / currentUnit) * currentUnit;
        else if (method === 'round') result = Math.round(val / currentUnit) * currentUnit;

        const finalOffset = ((result - baseStart) / currentUnit) * 100;
        document.getElementById('pointer-tag').style.left = finalOffset + 'px';
        
        msg.style.display = 'block';
        emoji.style.display = 'block';

        const isCorrectMethod = (method === currentMode);
        const hasRemainder = (val % currentUnit !== 0);

        if (isCorrectMethod) {
            emoji.innerText = "ğŸŒŸ";
            msg.innerHTML = `<span style="color:#2e7d32">âœ… æ­£ç¢ºï¼é€™å°±æ˜¯æœ€é©åˆçš„æ–¹æ³•ï¼</span><br>å–æ¦‚æ•¸åˆ°æŒ‡å®šä½å€¼å¾Œçš„çµæœæ˜¯ï¼š<span style="font-size:1.8rem; color:#1565c0;">${result.toLocaleString()}</span>`;
        } else {
            emoji.innerText = "ğŸ’¡";
            let hint = "è¨ˆç®—çµæœæ˜¯ " + result.toLocaleString() + "ã€‚ä½†è«‹å†è§€å¯Ÿä¸€æ¬¡ä»»å‹™æƒ…å¢ƒï¼Œæƒ³ä¸€æƒ³é€™ç¨®å–æ³•æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ";
            if (currentMode === 'ceil' && method === 'floor' && hasRemainder) {
                hint = "å“å‘€ï¼å¦‚æœç”¨æ¨å»æ³•ï¼Œçµæœæœƒå°‘æº–å‚™äº† " + (val % currentUnit) + " ä»½ï¼Œæœƒæœ‰äººæ‹¿ä¸åˆ°å–”ï¼å†è©¦è©¦çœ‹åˆ¥çš„æ–¹æ³•ã€‚";
            } else if (currentMode === 'floor' && method === 'ceil' && hasRemainder) {
                hint = "æ³¨æ„å–”ï¼ä»»å‹™è¦æ±‚æ˜¯è£æ»¿æ‰ç®—ï¼Œæˆ–è€…æ˜¯è¦å»é›¶é ­ã€‚å¦‚æœç”¨é€²å…¥æ³•ï¼Œæ•¸å­—è®Šå¤§äº†ï¼Œä¸ç¬¦åˆå¯¦éš›éœ€æ±‚ã€‚";
            }
            msg.innerHTML = `<span style="color:#d32f2f">å†æƒ³ä¸€ä¸‹å–”ï¼</span><br>${hint}`;
        }
    }
</script>
</body>
</html>
