<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>æ¦‚æ•¸é­”æ³•å¸«ï¼šæƒ…å¢ƒæ“´å……ç‰ˆ</title>
    <style>
        :root { --floor: #0d47a1; --ceil: #e65100; --round: #7b1fa2; --bg: #f4f7f9; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        
        #menu-screen { background: white; padding: 40px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 900px; text-align: center; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 25px; }
        .menu-card { padding: 20px; border-radius: 15px; color: white; cursor: pointer; transition: 0.3s; text-align: left; box-shadow: 0 5px 0 rgba(0,0,0,0.1); }
        .menu-card:hover { transform: translateY(-5px); filter: brightness(1.1); }
        .menu-card h3 { margin: 0 0 5px 0; font-size: 1.4rem; }
        .menu-card p { margin: 0; font-size: 1rem; opacity: 0.9; }

        #tool-screen { display: none; width: 1150px; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); text-align: center; }
        .control-panel { background: #f8f9fa; padding: 20px; border-radius: 25px; margin-bottom: 20px; }
        .pos-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .pos-btn { padding: 10px 18px; font-size: 1.1rem; cursor: pointer; border: 3px solid #ddd; border-radius: 10px; background: white; font-weight: bold; }
        .pos-btn.active { border-color: #4a90e2; background: #e3f2fd; color: #1976d2; }
        
        .input-area { display: flex; justify-content: center; align-items: center; gap: 20px; }
        input[type="number"], .result-box { font-size: 2.2rem; width: 200px; height: 70px; text-align: center; border-radius: 15px; font-weight: bold; }
        input[type="number"] { border: 5px solid #4a90e2; }
        .result-box { border: 5px solid #4caf50; background: #e8f5e9; color: #2e7d32; line-height: 70px; }

        .ruler-viewport { width: 1000px; height: 180px; margin: 40px auto; position: relative; }
        #arrow-wrapper { position: absolute; top: 30px; transform: translateX(-50%); transition: left 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 10; display: flex; flex-direction: column; align-items: center; }
        #value-bubble { background: #f44336; color: white; padding: 8px 20px; border-radius: 12px; font-size: 1.8rem; font-weight: bold; }
        #arrow-head { width: 0; height: 0; border-left: 12px solid transparent; border-right: 12px solid transparent; border-top: 18px solid #f44336; margin-top: -1px; }
        #impact-icon { position: absolute; top: -60px; font-size: 4rem; display: none; }

        .ruler-line { position: absolute; top: 110px; width: 1000px; height: 4px; background: #333; }
        .tick { position: absolute; top: 0; width: 2px; background: #bbb; height: 12px; }
        .tick.major { height: 45px; width: 4px; background: #000; }
        .tick-num { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); font-size: 16px; font-weight: bold; }

        .btn-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 25px; }
        .magic-btn { padding: 18px; font-size: 1.3rem; font-weight: bold; color: white; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 5px 0 rgba(0,0,0,0.2); }
        #feedback-msg { margin-top: 20px; font-size: 1.3rem; background: #fffde7; padding: 15px; border-radius: 15px; border: 2px dashed #fbc02d; min-height: 30px; }
    </style>
</head>
<body>

<div id="menu-screen">
    <h1>ğŸ’ æ¦‚æ•¸ç”Ÿæ´»å ´æ™¯æŒ‘æˆ°</h1>
    <div class="menu-grid">
        <div class="menu-card" style="background:#2ecc71" onclick="start('floor', 'ğŸª é»å¿ƒåŠè£ç›’', 'æ¯ 100 å€‹è£æˆä¸€ç›’ï¼Œå‰©ä¸‹ä¸æ»¿ä¸€ç›’çš„ä¸èƒ½ç®—ã€‚', 4628)">
            <h3>ğŸª é»å¿ƒåŠè£ç›’</h3><p>é¤…ä¹¾æ»¿ 100 å€‹æ‰ç®—ä¸€ç›’...</p>
        </div>
        <div class="menu-card" style="background:#e67e22" onclick="start('ceil', 'ğŸ“„ è€å¸«è²·è‰²ç´™', 'æ¯åŒ… 10 å¼µï¼Œå…¨ç­ 63 äººæ¯äººéƒ½è¦æœ‰ä¸€å¼µã€‚', 63)">
            <h3>ğŸ“„ è€å¸«è²·è‰²ç´™</h3><p>å°‘ä¸€å¼µéƒ½ä¸è¡Œï¼Œä¸€å®šè¦è²·å¤ ...</p>
        </div>
        <div class="menu-card" style="background:#3498db" onclick="start('floor', 'ğŸ›‹ï¸ å®¶å…·åº—ç‰¹è³£', 'åªè¦ä»˜æ•´åƒå…ƒï¼Œå¾Œé¢çš„é›¶é ­éƒ½ä¸ç®—ã€‚', 7999)">
            <h3>ğŸ›‹ï¸ å®¶å…·åº—ç‰¹è³£</h3><p>åªè¦ä»˜æ•´åƒå…ƒï¼Œå»é›¶é ­å„ªæƒ ...</p>
        </div>
        <div class="menu-card" style="background:#e74c3c" onclick="start('ceil', 'ğŸ« è²·ç¦®åˆ¸ç™¼æ”¾', 'ä¸€æœ¬ 100 å¼µï¼Œè¦ç™¼çµ¦ 12385 å€‹å“¡å·¥ã€‚', 12385)">
            <h3>ğŸ« è²·ç¦®åˆ¸ç™¼æ”¾</h3><p>æ¯äººéƒ½è¦æœ‰ä¸€å¼µï¼Œè¦è²·å¹¾å¼µæ‰å¤ ï¼Ÿ</p>
        </div>
        <div class="menu-card" style="background:#f1c40f; color:#333" onclick="start('ceil', 'ğŸ¦ å¤§è³£å ´æ¡è³¼', 'å…¨éƒ¨ç”¨ 100 å…ƒéˆ”ç¥¨ä»˜éŒ¢ï¼Œè¦ä»˜å¤šå°‘æ‰å¤ ï¼Ÿ', 1170)">
            <h3>ğŸ¦ å¤§è³£å ´æ¡è³¼</h3><p>å¸¶ç™¾å…ƒéˆ”è²·æ±è¥¿ï¼Œè¦å¸¶å¤šå°‘...</p>
        </div>
        <div class="menu-card" style="background:#9b59b6" onclick="start('round', 'ğŸ“ è·é›¢ä¼°è¨ˆ', 'çœ‹æ•¸å­—é›¢å“ªä¸€å€‹æ•´æ•¸æ¨™è¨˜æ¯”è¼ƒè¿‘ï¼Ÿ', 2137)">
            <h3>ğŸ“ è·é›¢ä¼°è¨ˆ</h3><p>å“ªä¸€å€‹æ¨™è¨˜æ¯”è¼ƒè¿‘å‘¢ï¼Ÿ</p>
        </div>
    </div>
</div>

<div id="tool-screen">
    <h2 id="quest-title">ä»»å‹™ä¸­...</h2>
    <p id="quest-desc" style="color:#666;"></p>
    
    <div class="control-panel">
        <div class="pos-group">
            <button class="pos-btn active" id="btn10" onclick="setPos(10)">åä½</button>
            <button class="pos-btn" id="btn100" onclick="setPos(100)">ç™¾ä½</button>
            <button class="pos-btn" id="btn1000" onclick="setPos(1000)">åƒä½</button>
            <button class="pos-btn" id="btn10000" onclick="setPos(10000)">è¬ä½</button>
        </div>
        <div class="input-area">
            <input type="number" id="inputVal" oninput="resetUI()">
            <div style="font-size: 2rem; color: #ccc;">âœ</div>
            <div id="resBox" class="result-box">?</div>
        </div>
    </div>

    <div class="ruler-viewport">
        <div id="arrow-wrapper">
            <div id="impact-icon">ğŸ˜°</div>
            <div id="value-bubble">0</div>
            <div id="arrow-head"></div>
        </div>
        <div class="ruler-line" id="ruler"></div>
    </div>

    <div class="btn-group">
        <button class="magic-btn" style="background:var(--floor)" onclick="castMagic('floor')">ç„¡æ¢ä»¶æ¨å»æ³•</button>
        <button class="magic-btn" style="background:var(--ceil)" onclick="castMagic('ceil')">ç„¡æ¢ä»¶é€²å…¥æ³•</button>
        <button class="magic-btn" style="background:var(--round)" onclick="castMagic('round')">å››æ¨äº”å…¥æ³•</button>
    </div>
    <div id="feedback-msg"></div>
    <button style="margin-top:20px; background:none; border:none; color:#888; cursor:pointer; text-decoration:underline;" onclick="location.reload()">â¬… è¿”å›é¸å–®</button>
</div>

<script>
    let questType = ''; let pos = 10; let rangeStart = 0;

    function start(type, title, desc, defaultVal) {
        questType = type;
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('tool-screen').style.display = 'block';
        document.getElementById('quest-title').innerText = title;
        document.getElementById('quest-desc').innerText = desc;
        document.getElementById('inputVal').value = defaultVal;
        
        // æ ¹æ“šé è¨­å€¼è‡ªå‹•é¸æ“‡æœ€é©åˆçš„ä½å€¼
        if (defaultVal >= 10000) setPos(10000);
        else if (defaultVal >= 1000) setPos(1000);
        else if (defaultVal >= 100) setPos(100);
        else setPos(10);
    }

    function setPos(p) {
        pos = p;
        document.querySelectorAll('.pos-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn' + p).classList.add('active');
        resetUI();
    }

    function resetUI() {
        const val = parseInt(document.getElementById('inputVal').value) || 0;
        document.getElementById('resBox').innerText = '?';
        document.getElementById('impact-icon').style.display = 'none';
        document.getElementById('feedback-msg').innerHTML = "ğŸ’¡ è«‹é¸æ“‡æ¦‚æ•¸æ–¹æ³•...";
        
        const ruler = document.getElementById('ruler'); ruler.innerHTML = '';
        rangeStart = Math.floor(val / (pos * 10)) * (pos * 10);

        for (let i = 0; i <= 10; i++) {
            const currentNum = rangeStart + (i * pos);
            const tick = document.createElement('div'); tick.className = 'tick major'; tick.style.left = (i * 100) + 'px';
            const n = document.createElement('div'); n.className = 'tick-num'; n.innerText = currentNum.toLocaleString();
            tick.appendChild(n); ruler.appendChild(tick);
            if(i < 10) for(let j=1; j<10; j++) {
                const small = document.createElement('div'); small.className = 'tick'; small.style.left = (i*100 + j*10) + 'px'; ruler.appendChild(small);
            }
        }
        const offset = ((val - rangeStart) / pos) * 100;
        document.getElementById('arrow-wrapper').style.left = offset + 'px';
        document.getElementById('value-bubble').innerText = val.toLocaleString();
    }

    function castMagic(method) {
        const val = parseInt(document.getElementById('inputVal').value) || 0;
        let res = (method === 'floor') ? Math.floor(val/pos)*pos : (method === 'ceil') ? Math.ceil(val/pos)*pos : Math.round(val/pos)*pos;

        document.getElementById('resBox').innerText = res.toLocaleString();
        document.getElementById('arrow-wrapper').style.left = (((res - rangeStart) / pos) * 100) + 'px';
        
        const icon = document.getElementById('impact-icon'); const msg = document.getElementById('feedback-msg');
        const hasRem = (val % pos !== 0);

        if (questType === 'ceil' && method === 'floor' && hasRem) {
            icon.innerText = "ğŸ˜°"; icon.style.display = 'block';
            msg.innerHTML = `âŒ <b>å¤±æ•—ï¼</b> ç”¨æ¨å»æ³•æœƒå°‘è²· <b>${val % pos}</b> ä»½ï¼Œæœ‰äººæ‹¿ä¸åˆ°å–”ï¼`;
        } else if (questType === 'floor' && method === 'ceil' && hasRem) {
            icon.innerText = "ğŸ’¸"; icon.style.display = 'block';
            msg.innerHTML = `âŒ <b>å¤±æ•—ï¼</b> é€™æ¨£ä»˜éŒ¢è®Šå¤šäº†ï¼Œä¸ç¬¦åˆå»é›¶é ­å„ªæƒ ã€‚`;
        } else if (method === questType) {
            icon.innerText = "ğŸŒŸ"; icon.style.display = 'block';
            msg.innerHTML = `âœ… <b>æ­£ç¢ºï¼</b> é€™å°±æ˜¯è§£æ±ºé€™å€‹ä»»å‹™çš„æœ€ä½³æ–¹æ³•ï¼`;
        } else {
            icon.innerText = "â“"; icon.style.display = 'block';
            msg.innerHTML = `ğŸ’¡ è¨ˆç®—çµæœæ˜¯ ${res}ï¼Œä½†æƒ…å¢ƒåˆ¤æ–·å¯ä»¥å†æƒ³æƒ³ã€‚`;
        }
    }
</script>
</body>
</html>
